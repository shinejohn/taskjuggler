import{a as H,r as g,c as K,m as x,q as p,p as t,s as u,u as e,y as n,n as y,t as W,F as D,x as I,J as Y,b as k,v as C,f as d,o as Z,w as tt,B as T,C as et,H as M,A as F}from"./vue-vendor-u6tZf2HN.js";import{_ as st}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BFNf4mOZ.js";import{c as U,f as E,a5 as q,X as ot,j as lt,P as J,ai as nt,e as at,s as it,a7 as rt,a8 as R,aj as dt,ak as ct,al as ut,a9 as xt,af as ft,ag as mt}from"./ui-vendor-o_tb4bfv.js";import{u as bt}from"./calls-D05dn_Yj.js";import{useOrganizationsStore as pt}from"./organizations-BtYa45au.js";import{c as gt,d as vt,e as ht}from"./format-DaYpM1Fu.js";import{a as yt}from"./status-DdzIA5VN.js";import{b as _t,g as wt,c as Ct,a as kt}from"./contact-MrFpTDs4.js";import{c as $t}from"./request-t1OiQL2I.js";import"./index-14mik_sv.js";import"./utils-vendor-B9ygI19o.js";const zt={class:"sticky top-0 bg-white border-b border-slate-100 p-6 flex justify-between items-start z-10"},Bt={class:"flex items-center gap-2 text-sm text-slate-500 mt-1"},Ft={class:"flex gap-2"},Dt={key:0,class:"flex-1 p-6 space-y-8 overflow-y-auto"},St={class:"flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-100"},Ot={class:"flex items-center gap-3"},Pt={class:"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500"},jt={class:"font-bold text-slate-900"},Nt={class:"text-xs text-slate-500"},Tt={class:"flex items-center gap-3 text-right"},It={class:"font-bold text-slate-900"},Ut={class:"w-10 h-10 rounded-full bg-blue-100 text-[#1B4F72] flex items-center justify-center font-bold"},At={class:"flex justify-center"},Vt={key:0,class:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm"},Lt={class:"h-12 flex items-center gap-0.5 mb-4 px-2"},Mt={class:"flex items-center gap-4"},Rt={class:"flex-1"},Ht={class:"flex justify-between text-xs text-slate-500 mt-1"},Et={key:1,class:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm"},qt={class:"space-y-3 text-sm text-slate-700"},Jt={class:"font-semibold text-xs text-slate-500 mb-1"},Qt={key:2,class:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm"},Xt={class:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2"},Gt={class:"text-sm text-slate-700"},Kt=H({__name:"CallDetailPanel",props:{call:{},isOpen:{type:Boolean}},emits:["close"],setup(r){const a=r,m=g(!1),_=K(()=>a.call?.transcript?[{speaker:"coordinator",text:"Hello, thank you for calling..."},{speaker:"customer",text:"Hi, I need to schedule an appointment..."}]:[]);function b(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function v(i){return i?new Date(i).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):""}function w(i){const o=Math.floor(i/60),f=i%60;return`${o}:${f.toString().padStart(2,"0")}`}function $(i){if(i.contact){const o=i.contact;return`${o.first_name} ${o.last_name||""}`.trim()||"Unknown"}return"Unknown"}function h(i){return i.coordinator?i.coordinator.display_name||"Coordinator":"Unknown"}function S(i){return h(i).charAt(0).toUpperCase()}function O(i){if(!i)return"bg-slate-50 text-slate-600 border-slate-200";const o=i.toLowerCase();return o.includes("booked")||o.includes("confirmed")?"bg-green-50 text-green-700 border-green-200":o.includes("info")?"bg-blue-50 text-blue-700 border-blue-200":o.includes("transferred")?"bg-amber-50 text-amber-700 border-amber-200":"bg-slate-50 text-slate-600 border-slate-200"}function P(){m.value=!m.value}function j(){a.call?.recording_url&&window.open(a.call.recording_url,"_blank")}return(i,o)=>(d(),x(D,null,[r.isOpen?(d(),x("div",{key:0,class:"fixed inset-0 bg-black/20 z-40 transition-opacity",onClick:o[0]||(o[0]=f=>i.$emit("close"))})):p("",!0),t("div",{class:y(["fixed top-0 right-0 h-full w-full sm:w-[500px] bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out overflow-y-auto flex flex-col",r.isOpen?"translate-x-0":"translate-x-full"])},[t("div",zt,[t("div",null,[o[3]||(o[3]=t("h2",{class:"text-xl font-bold text-slate-900"},"Call Details",-1)),t("div",Bt,[u(e(U),{size:14}),t("span",null,n(b(r.call?.started_at))+" at "+n(v(r.call?.started_at)),1),o[2]||(o[2]=t("span",null,"â€¢",-1)),u(e(E),{size:14}),t("span",null,n(w(r.call?.duration_seconds||0)),1)])]),t("div",Ft,[r.call?.recording_url?(d(),x("button",{key:0,onClick:j,class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors"},[u(e(q),{size:20})])):p("",!0),t("button",{onClick:o[1]||(o[1]=f=>i.$emit("close")),class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors"},[u(e(ot),{size:20})])])]),r.call?(d(),x("div",Dt,[t("div",St,[t("div",Ot,[t("div",Pt,[u(e(lt),{size:20})]),t("div",null,[t("div",jt,n($(r.call)),1),t("div",Nt,n(r.call.from_number),1)])]),o[5]||(o[5]=t("div",{class:"h-8 w-px bg-slate-200"},null,-1)),t("div",Tt,[t("div",null,[t("div",It,n(h(r.call)),1),o[4]||(o[4]=t("div",{class:"text-xs text-slate-500"},"Coordinator",-1))]),t("div",Ut,n(S(r.call)),1)])]),t("div",At,[t("span",{class:y(["px-4 py-1.5 rounded-full text-sm font-medium border",O(r.call.outcome)])},n(r.call.outcome||"Completed"),3)]),r.call.recording_url?(d(),x("div",Vt,[o[8]||(o[8]=W('<div class="flex items-center justify-between mb-4"><h3 class="text-sm font-bold text-slate-900">Recording</h3><div class="flex gap-2 text-xs font-medium text-slate-500"><button class="hover:text-[#1B4F72]">1x</button><button class="hover:text-[#1B4F72]">1.5x</button><button class="hover:text-[#1B4F72]">2x</button></div></div>',1)),t("div",Lt,[(d(),x(D,null,I(40,f=>t("div",{key:f,class:y(["w-1.5 rounded-full transition-all",f<15?"bg-[#1B4F72]":"bg-slate-200"]),style:Y({height:`${Math.max(20,Math.random()*100)}%`})},null,6)),64))]),t("div",Mt,[t("button",{onClick:P,class:"w-10 h-10 rounded-full bg-[#1B4F72] text-white flex items-center justify-center hover:bg-[#153e5a] transition-colors shadow-sm"},[m.value?(d(),k(e(nt),{key:1,size:18})):(d(),k(e(J),{key:0,size:18,fill:"currentColor",class:"ml-0.5"}))]),t("div",Rt,[o[7]||(o[7]=t("div",{class:"h-1 bg-slate-200 rounded-full overflow-hidden"},[t("div",{class:"h-full bg-[#1B4F72] rounded-full",style:{width:"35%"}})],-1)),t("div",Ht,[o[6]||(o[6]=t("span",null,"0:45",-1)),t("span",null,n(w(r.call.duration_seconds)),1)])])])])):p("",!0),r.call.transcript?(d(),x("div",Et,[o[9]||(o[9]=t("h3",{class:"text-sm font-bold text-slate-900 mb-3"},"Transcript",-1)),t("div",qt,[(d(!0),x(D,null,I(_.value,(f,z)=>(d(),x("div",{key:z,class:y(["p-3 rounded-lg",f.speaker==="coordinator"?"bg-blue-50":"bg-slate-50"])},[t("div",Jt,n(f.speaker==="coordinator"?h(r.call):$(r.call)),1),t("div",null,n(f.text),1)],2))),128))])])):p("",!0),r.call.ai_summary?(d(),x("div",Qt,[t("h3",Xt,[u(e(at),{size:16,class:"text-amber-500"}),o[10]||(o[10]=C(" AI Summary ",-1))]),t("p",Gt,n(r.call.ai_summary),1)])):p("",!0)])):p("",!0)],2)],64))}}),Wt={class:"space-y-6"},Yt={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},Zt={class:"text-slate-500 mt-1"},te={class:"flex gap-3"},ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},se={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4"},oe={class:"p-3 bg-blue-50 text-[#1B4F72] rounded-lg"},le={class:"text-2xl font-bold text-slate-900"},ne={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4"},ae={class:"p-3 bg-amber-50 text-amber-600 rounded-lg"},ie={class:"text-2xl font-bold text-slate-900"},re={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4"},de={class:"p-3 bg-green-50 text-green-600 rounded-lg"},ce={class:"text-2xl font-bold text-slate-900"},ue={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4"},xe={class:"relative"},fe={class:"flex flex-wrap gap-3 items-center"},me={class:"relative"},be={class:"relative"},pe={key:0,class:"text-center py-12"},ge={key:1,class:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden"},ve={class:"overflow-x-auto"},he={class:"w-full text-sm text-left"},ye={class:"divide-y divide-slate-100"},_e=["onClick"],we={class:"px-6 py-4 text-slate-500"},Ce={class:"font-medium text-slate-900"},ke={class:"text-xs"},$e={class:"px-6 py-4 font-medium text-slate-900"},ze={class:"flex items-center gap-2"},Be={class:"w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500"},Fe={class:"px-6 py-4 text-slate-500 font-mono text-xs"},De={class:"px-6 py-4"},Se={class:"flex items-center gap-2"},Oe={class:"w-6 h-6 rounded-full bg-blue-50 text-[#1B4F72] flex items-center justify-center text-[10px] font-bold"},Pe={class:"text-sm text-slate-600"},je={class:"px-6 py-4"},Ne={class:"px-6 py-4 text-slate-500 font-mono text-xs"},Te={class:"px-6 py-4"},Ie={class:"flex items-center justify-end gap-2"},Ue=["onClick"],Ae=["onClick"],Ve=["onClick"],Le={key:0},Me={class:"px-6 py-4 border-t border-slate-200 flex items-center justify-between"},Re={class:"text-sm text-slate-500"},He={class:"flex gap-2"},Ee=["disabled"],qe=["disabled"],os=H({__name:"CallsPage",setup(r){const a=bt(),m=pt(),_=g(""),b=g(""),v=g(""),w=g(!1),$=ht,h=gt,S=yt,O=c=>wt(c),P=c=>_t(c),j=c=>kt(c),i=c=>Ct(c),o=g(null),f=g(!1);function z(c){o.value=c,f.value=!0}function Q(c){c.recording_url&&window.open(c.recording_url,"_blank")}function X(c){o.value=c,f.value=!0}const A=$t(()=>{B()},300);function V(){B()}function L(c){B({page:c})}function G(){}async function B(c){try{await Promise.all([a.fetchCalls({search:_.value||void 0,direction:b.value||void 0,outcome:v.value||void 0,...c}),a.fetchStats({direction:b.value&&(b.value==="inbound"||b.value==="outbound")?b.value:void 0,outcome:v.value||void 0})])}catch(s){console.error("Failed to fetch calls:",s)}}return Z(async()=>{try{m.currentOrganization||(await m.fetchOrganizations(),m.organizations.length>0&&m.setCurrentOrganization(m.organizations[0])),m.currentOrganization?.id&&await B()}catch(c){console.error("Failed to load calls:",c)}}),(c,s)=>(d(),k(st,null,{default:tt(()=>[t("div",Wt,[t("div",Yt,[t("div",null,[s[9]||(s[9]=t("h1",{class:"text-3xl font-heading font-bold text-[#1B4F72]"}," Call History ",-1)),t("p",Zt,n(e(a).total)+" total calls",1)]),t("div",te,[t("button",{onClick:s[0]||(s[0]=l=>w.value=!w.value),class:"px-4 py-2.5 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2"},[u(e(U),{size:18}),s[10]||(s[10]=C(" Last 30 Days ",-1))]),t("button",{onClick:G,class:"px-4 py-2.5 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2"},[u(e(q),{size:18}),s[11]||(s[11]=C(" Export ",-1))])])]),t("div",ee,[t("div",se,[t("div",oe,[u(e(it),{size:24})]),t("div",null,[t("div",le,n(e(a).stats?.calls_today||0),1),s[12]||(s[12]=t("div",{class:"text-sm text-slate-500"},"Calls Today",-1))])]),t("div",ne,[t("div",ae,[u(e(E),{size:24})]),t("div",null,[t("div",ie,n(e(h)(e(a).stats?.avg_duration||0)),1),s[13]||(s[13]=t("div",{class:"text-sm text-slate-500"},"Avg Duration",-1))])]),t("div",re,[t("div",de,[u(e(U),{size:24})]),t("div",null,[t("div",ce,n(e(a).stats?.booking_rate||0)+"% ",1),s[14]||(s[14]=t("div",{class:"text-sm text-slate-500"},"Booking Rate",-1))])])]),t("div",ue,[t("div",xe,[u(e(rt),{class:"absolute left-3 top-3 text-slate-400",size:20}),T(t("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>_.value=l),type:"text",placeholder:"Search by contact name or phone...",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72]",onInput:s[2]||(s[2]=(...l)=>e(A)&&e(A)(...l))},null,544),[[et,_.value]])]),t("div",fe,[t("div",me,[T(t("select",{"onUpdate:modelValue":s[3]||(s[3]=l=>b.value=l),class:"appearance-none pl-3 pr-8 py-1.5 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] cursor-pointer hover:bg-slate-50",onChange:V},[...s[15]||(s[15]=[t("option",{value:""},"Direction: All",-1),t("option",{value:"inbound"},"Inbound",-1),t("option",{value:"outbound"},"Outbound",-1)])],544),[[M,b.value]]),u(e(R),{class:"absolute right-2.5 top-2 text-slate-400 pointer-events-none",size:12})]),t("div",be,[T(t("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>v.value=l),class:"appearance-none pl-3 pr-8 py-1.5 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] cursor-pointer hover:bg-slate-50",onChange:V},[...s[16]||(s[16]=[t("option",{value:""},"Outcome: All",-1),t("option",{value:"booked"},"Appointment Booked",-1),t("option",{value:"confirmed"},"Confirmed",-1),t("option",{value:"info"},"Info Only",-1)])],544),[[M,v.value]]),u(e(R),{class:"absolute right-2.5 top-2 text-slate-400 pointer-events-none",size:12})])])]),e(a).loading?(d(),x("div",pe,[...s[17]||(s[17]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4F72]"},null,-1),t("p",{class:"mt-4 text-slate-500"},"Loading calls...",-1)])])):(d(),x("div",ge,[t("div",ve,[t("table",he,[s[19]||(s[19]=t("thead",{class:"bg-slate-50 text-slate-500 font-medium border-b border-slate-200"},[t("tr",null,[t("th",{class:"px-6 py-3"},"Date/Time"),t("th",{class:"px-6 py-3"},"Contact"),t("th",{class:"px-6 py-3"},"Phone"),t("th",{class:"px-6 py-3"},"Coordinator"),t("th",{class:"px-6 py-3"},"Direction"),t("th",{class:"px-6 py-3"},"Duration"),t("th",{class:"px-6 py-3"},"Outcome"),t("th",{class:"px-6 py-3 text-right"},"Actions")])],-1)),t("tbody",ye,[(d(!0),x(D,null,I(e(a).calls,l=>(d(),x("tr",{key:l.id,class:"hover:bg-slate-50 transition-colors cursor-pointer",onClick:N=>z(l)},[t("td",we,[t("div",Ce,n(e(vt)(l.started_at)),1),t("div",ke,n(e($)(l.started_at)),1)]),t("td",$e,[t("div",ze,[t("div",Be,n(P(l)),1),C(" "+n(O(l)),1)])]),t("td",Fe,n(l.from_number),1),t("td",De,[t("div",Se,[t("div",Oe,n(i(l)),1),t("span",Pe,n(j(l)),1)])]),t("td",je,[t("div",{class:y(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",l.direction==="inbound"?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"])},[l.direction==="inbound"?(d(),k(e(dt),{key:0,size:12})):(d(),k(e(ct),{key:1,size:12})),C(" "+n(l.direction==="inbound"?"Inbound":"Outbound"),1)],2)]),t("td",Ne,n(e(h)(l.duration_seconds)),1),t("td",Te,[t("span",{class:y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e(S)(l.outcome)])},n(l.outcome||"Completed"),3)]),t("td",{class:"px-6 py-4 text-right",onClick:s[5]||(s[5]=F(()=>{},["stop"]))},[t("div",Ie,[l.recording_url?(d(),x("button",{key:0,onClick:F(N=>Q(l),["stop"]),class:"p-1.5 text-slate-400 hover:text-[#1B4F72] rounded hover:bg-slate-100",title:"Play Recording"},[u(e(J),{size:16})],8,Ue)):p("",!0),l.transcript?(d(),x("button",{key:1,onClick:F(N=>X(l),["stop"]),class:"p-1.5 text-slate-400 hover:text-[#1B4F72] rounded hover:bg-slate-100",title:"View Transcript"},[u(e(ut),{size:16})],8,Ae)):p("",!0),t("button",{onClick:F(N=>z(l),["stop"]),class:"p-1.5 text-slate-400 hover:text-[#1B4F72] rounded hover:bg-slate-100"},[u(e(xt),{size:16})],8,Ve)])])],8,_e))),128)),e(a).calls.length===0?(d(),x("tr",Le,[...s[18]||(s[18]=[t("td",{colspan:"8",class:"px-6 py-8 text-center text-slate-500"}," No calls found ",-1)])])):p("",!0)])])]),t("div",Me,[t("span",Re," Showing "+n((e(a).page-1)*e(a).perPage+1)+"- "+n(Math.min(e(a).page*e(a).perPage,e(a).total))+" of "+n(e(a).total),1),t("div",He,[t("button",{disabled:e(a).page===1,onClick:s[6]||(s[6]=l=>L(e(a).page-1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-50"},[u(e(ft),{size:16})],8,Ee),t("button",{disabled:e(a).page*e(a).perPage>=e(a).total,onClick:s[7]||(s[7]=l=>L(e(a).page+1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50"},[u(e(mt),{size:16})],8,qe)])])]))]),u(Kt,{call:o.value,"is-open":f.value,onClose:s[8]||(s[8]=l=>f.value=!1)},null,8,["call","is-open"])]),_:1}))}});export{os as default};
