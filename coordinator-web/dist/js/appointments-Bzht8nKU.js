import{d as F,r as d}from"./vue-vendor-lZgBCM-Y.js";import{a as g}from"./index-BdtiHmgt.js";import{useOrganizationsStore as m}from"./organizations-B-TbRSUr.js";const v={getAll:(t,e)=>g.get(`/coordinator/organizations/${t}/appointments`,{params:e}),getToday:t=>g.get(`/coordinator/organizations/${t}/appointments/today`),getById:(t,e)=>g.get(`/coordinator/organizations/${t}/appointments/${e}`),create:(t,e)=>g.post(`/coordinator/organizations/${t}/appointments`,e),update:(t,e,i)=>g.put(`/coordinator/organizations/${t}/appointments/${e}`,i),cancel:(t,e,i)=>g.post(`/coordinator/organizations/${t}/appointments/${e}/cancel`,{reason:i}),delete:(t,e)=>g.delete(`/coordinator/organizations/${t}/appointments/${e}`)};class N{updates=new Map;register(e,i,s){this.updates.set(e,{id:e,data:i,timestamp:Date.now(),rollback:s})}confirm(e){this.updates.delete(e)}rollback(e){const i=this.updates.get(e);i&&(i.rollback(),this.updates.delete(e))}rollbackAll(){this.updates.forEach(e=>{e.rollback()}),this.updates.clear()}get(e){return this.updates.get(e)}has(e){return this.updates.has(e)}clear(){this.updates.clear()}}const y=new N;function b(t,e,i){return y.register(t,e,i),()=>{y.confirm(t)}}async function k(t,e,i,s){const l=b(t,e,i);try{const f=await s();return l(),f}catch(f){throw y.rollback(t),f}}const T=F("appointments",()=>{const t=d([]),e=d([]),i=d(null),s=d(!1),l=d(null),f=d(0),h=d(1),w=d(15);async function O(a){const r=m();if(!r.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{const n=await v.getAll(r.currentOrganization.id,{...a,page:a?.page||h.value,per_page:a?.per_page||w.value}),o=n.data.data||n.data;t.value=Array.isArray(o)?o:o.data,f.value=n.data.total||(o.meta?o.meta.total:o.length),h.value=n.data.page||(o.meta?o.meta.current_page:h.value),w.value=n.data.per_page||(o.meta?o.meta.per_page:w.value)}catch(n){throw l.value=n.response?.data?.message||"Failed to load appointments",n}finally{s.value=!1}}async function S(){const a=m();if(!a.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{const r=await v.getToday(a.currentOrganization.id);e.value=r.data.data||r.data}catch(r){throw l.value=r.response?.data?.message||"Failed to load today's appointments",r}finally{s.value=!1}}async function A(a){const r=m();if(!r.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{const n=await v.getById(r.currentOrganization.id,a),o=n.data.data||n.data;return i.value=o,o}catch(n){throw l.value=n.response?.data?.message||"Failed to load appointment",n}finally{s.value=!1}}async function _(a){const r=m();if(!r.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;const n=`temp-${Date.now()}`,o={id:n,organization_id:r.currentOrganization.id,contact_id:a.contact_id||"",title:a.title||"",description:a.description,starts_at:a.starts_at||new Date().toISOString(),ends_at:a.ends_at||new Date().toISOString(),status:"pending",location_type:a.location_type||"in-person",location:a.location,notes:a.notes,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),...a},u=()=>{const c=t.value.findIndex(p=>p.id===n);c!==-1&&t.value.splice(c,1)};try{t.value.push(o);const c=await k(n,o,u,async()=>await v.create(r.currentOrganization.id,a)),p=c.data.data||c.data,z=t.value.findIndex(E=>E.id===n);return z!==-1?t.value[z]=p:t.value.push(p),p}catch(c){throw l.value=c.response?.data?.message||"Failed to create appointment",c}finally{s.value=!1}}async function $(a,r){const n=m();if(!n.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{const o=await v.update(n.currentOrganization.id,a,r),u=o.data.data||o.data,c=t.value.findIndex(p=>p.id===a);return c!==-1&&(t.value[c]=u),i.value?.id===a&&(i.value=u),u}catch(o){throw l.value=o.response?.data?.message||"Failed to update appointment",o}finally{s.value=!1}}async function I(a,r){const n=m();if(!n.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{const o=await v.cancel(n.currentOrganization.id,a,r),u=o.data.data||o.data,c=t.value.findIndex(p=>p.id===a);return c!==-1&&(t.value[c]=u),i.value?.id===a&&(i.value=u),u}catch(o){throw l.value=o.response?.data?.message||"Failed to cancel appointment",o}finally{s.value=!1}}async function x(a){const r=m();if(!r.currentOrganization?.id)throw new Error("No organization selected");s.value=!0,l.value=null;try{await v.delete(r.currentOrganization.id,a),t.value=t.value.filter(n=>n.id!==a),i.value?.id===a&&(i.value=null)}catch(n){throw l.value=n.response?.data?.message||"Failed to delete appointment",n}finally{s.value=!1}}return{appointments:t,todayAppointments:e,currentAppointment:i,loading:s,error:l,total:f,page:h,perPage:w,fetchAppointments:O,fetchTodayAppointments:S,fetchAppointment:A,createAppointment:_,updateAppointment:$,cancelAppointment:I,deleteAppointment:x}});export{T as u};
