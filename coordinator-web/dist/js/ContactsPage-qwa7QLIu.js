import{a as q,r as h,K as G,m as y,q as D,p as t,y as f,s as p,u as a,v as C,F as E,x as V,n as L,B as U,C as Q,f as b,d as J,c as W,o as Z,b as tt,w as et,H as st,A as j}from"./vue-vendor-u6tZf2HN.js";import{_ as ot}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BFNf4mOZ.js";import{X as R,s as at,Y,g as nt,aa as H,a3 as K,c as lt,ab as rt,ac as it,ad as dt,a7 as ct,a8 as ut,ae as ft,a9 as pt,af as gt,ag as vt,ah as xt}from"./ui-vendor-o_tb4bfv.js";import{a as S}from"./index-14mik_sv.js";import{useOrganizationsStore as $}from"./organizations-BtYa45au.js";import{c as mt}from"./request-t1OiQL2I.js";import"./utils-vendor-B9ygI19o.js";const bt={class:"sticky top-0 bg-white border-b border-slate-100 p-6 flex justify-between items-start z-10"},ht={class:"flex items-center gap-4"},yt={class:"w-12 h-12 rounded-full bg-blue-50 text-[#1B4F72] flex items-center justify-center text-xl font-bold"},wt={class:"text-xl font-bold text-slate-900"},zt={class:"text-sm text-slate-500"},Ct={key:0,class:"p-6 space-y-8"},kt={class:"space-y-4"},$t={class:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100"},_t={class:"flex items-center gap-3"},Ft={class:"font-mono text-sm font-medium text-slate-700"},Bt={class:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100"},St={class:"flex items-center gap-3"},Tt={class:"text-sm font-medium text-slate-700"},At={class:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2"},Ot={class:"flex flex-wrap gap-2"},Nt={class:"text-sm font-bold text-slate-900 mb-4 flex items-center gap-2"},Dt={class:"space-y-4 relative pl-2"},Mt={class:"text-xs font-bold text-slate-400 mb-1"},Et={class:"font-medium text-slate-900"},Pt={class:"text-xs text-slate-500"},It={key:0,class:"text-sm text-slate-500 pl-6"},Vt={class:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2"},jt=q({__name:"ContactSidebar",props:{contact:{},isOpen:{type:Boolean}},emits:["close"],setup(o){const s=o,r=h(""),c=h(!1),z=h([{type:"call",date:"Today, 10:42 AM",desc:"Appointment Booked",by:"Sally"},{type:"appointment",date:"Yesterday, 2:15 PM",desc:"Service Call Completed",by:"Ed"}]);G(()=>s.contact,x=>{x&&(r.value=x.notes||"")});function g(x){if(!x)return"Recently";const l=new Date(x),k=Math.floor((new Date().getTime()-l.getTime())/(1e3*60*60*24));return k===0?"Today":k===1?"Yesterday":k<7?`${k} days ago`:l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function _(x){return{call:"bg-blue-500",appointment:"bg-green-500",message:"bg-purple-500",note:"bg-amber-500"}[x]||"bg-slate-400"}function A(x){x&&x!=="N/A"&&navigator.clipboard.writeText(x)}function M(){}return(x,l)=>(b(),y(E,null,[o.isOpen?(b(),y("div",{key:0,class:"fixed inset-0 bg-black/20 z-40 transition-opacity",onClick:l[0]||(l[0]=v=>x.$emit("close"))})):D("",!0),t("div",{class:L(["fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out overflow-y-auto",o.isOpen?"translate-x-0":"translate-x-full"])},[t("div",bt,[t("div",ht,[t("div",yt,f(o.contact?.first_name?.charAt(0)||"?"),1),t("div",null,[t("h2",wt,f(o.contact?.first_name)+" "+f(o.contact?.last_name||""),1),t("p",zt," Added "+f(g(o.contact?.created_at)),1)])]),t("button",{onClick:l[1]||(l[1]=v=>x.$emit("close")),class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors"},[p(a(R),{size:20})])]),o.contact?(b(),y("div",Ct,[t("section",kt,[t("div",$t,[t("div",_t,[p(a(at),{size:18,class:"text-slate-400"}),t("span",Ft,f(o.contact.phone||"N/A"),1)]),t("button",{onClick:l[2]||(l[2]=v=>o.contact.phone?A(o.contact.phone):void 0),class:"text-slate-400 hover:text-[#1B4F72]"},[p(a(Y),{size:14})])]),t("div",Bt,[t("div",St,[p(a(nt),{size:18,class:"text-slate-400"}),t("span",Tt,f(o.contact.email||"N/A"),1)]),t("button",{onClick:l[3]||(l[3]=v=>o.contact.email?A(o.contact.email):void 0),class:"text-slate-400 hover:text-[#1B4F72]"},[p(a(Y),{size:14})])])]),t("section",null,[t("h3",At,[p(a(H),{size:16,class:"text-slate-400"}),l[6]||(l[6]=C(" Tags ",-1))]),t("div",Ot,[(b(!0),y(E,null,V(o.contact.tags||[],v=>(b(),y("span",{key:v,class:"px-2.5 py-1 rounded-full bg-blue-50 text-[#1B4F72] text-xs font-medium border border-blue-100"},f(v),1))),128)),t("button",{onClick:l[4]||(l[4]=v=>c.value=!0),class:"px-2.5 py-1 rounded-full border border-dashed border-slate-300 text-slate-500 text-xs font-medium hover:border-[#1B4F72] hover:text-[#1B4F72] flex items-center gap-1 transition-colors"},[p(a(K),{size:12}),l[7]||(l[7]=C(" Add ",-1))])])]),t("section",null,[t("h3",Nt,[p(a(lt),{size:16,class:"text-slate-400"}),l[8]||(l[8]=C(" Interaction Timeline ",-1))]),t("div",Dt,[l[9]||(l[9]=t("div",{class:"absolute left-[5px] top-2 bottom-2 w-0.5 bg-slate-100"},null,-1)),(b(!0),y(E,null,V(z.value,(v,k)=>(b(),y("div",{key:k,class:"relative pl-6"},[t("div",{class:L(["absolute left-0 top-1 w-3 h-3 rounded-full border-2 border-white",_(v.type)])},null,2),t("div",Mt,f(v.date),1),t("div",Et,f(v.desc),1),t("div",Pt,"by "+f(v.by),1)]))),128)),z.value.length===0?(b(),y("div",It," No interactions yet ")):D("",!0)])]),t("section",null,[t("h3",Vt,[p(a(rt),{size:16,class:"text-slate-400"}),l[10]||(l[10]=C(" Notes ",-1))]),U(t("textarea",{"onUpdate:modelValue":l[5]||(l[5]=v=>r.value=v),class:"w-full p-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] min-h-[100px]",placeholder:"Add a note about this contact..."},null,512),[[Q,r.value]]),t("button",{onClick:M,class:"mt-2 px-4 py-2 bg-[#1B4F72] text-white rounded-lg hover:bg-[#153e5a] transition-colors flex items-center gap-2"},[p(a(it),{size:16}),l[11]||(l[11]=C(" Save Note ",-1))])])])):D("",!0)],2)],64))}}),T={getAll:(o,s)=>S.get(`/coordinator/organizations/${o}/contacts`,{params:s}),getById:(o,s)=>S.get(`/coordinator/organizations/${o}/contacts/${s}`),create:(o,s)=>S.post(`/coordinator/organizations/${o}/contacts`,s),update:(o,s,r)=>S.put(`/coordinator/organizations/${o}/contacts/${s}`,r),delete:(o,s)=>S.delete(`/coordinator/organizations/${o}/contacts/${s}`),bulkDelete:(o,s)=>S.post(`/coordinator/organizations/${o}/contacts/bulk-delete`,{ids:s}),bulkTag:(o,s,r)=>S.post(`/coordinator/organizations/${o}/contacts/bulk-tag`,{ids:s,tags:r})},Lt=J("contacts",()=>{const o=h([]),s=h(null),r=h(!1),c=h(null),z=h(0),g=h(1),_=h(15);async function A(d){const u=$();if(!u.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{const n=await T.getAll(u.currentOrganization.id,{...d,page:d?.page||g.value,per_page:d?.per_page||_.value});o.value=n.data.data,z.value=n.data.total,g.value=n.data.page,_.value=n.data.per_page}catch(n){throw c.value=n.response?.data?.message||"Failed to load contacts",n}finally{r.value=!1}}async function M(d){const u=$();if(!u.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{const n=await T.getById(u.currentOrganization.id,d);return s.value=n.data,n.data}catch(n){throw c.value=n.response?.data?.message||"Failed to load contact",n}finally{r.value=!1}}async function x(d){const u=$();if(!u.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{const n=await T.create(u.currentOrganization.id,d);return o.value.unshift(n.data),z.value+=1,n.data}catch(n){throw c.value=n.response?.data?.message||"Failed to create contact",n}finally{r.value=!1}}async function l(d,u){const n=$();if(!n.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{const w=await T.update(n.currentOrganization.id,d,u),O=o.value.findIndex(I=>I.id===d);return O!==-1&&(o.value[O]=w.data),s.value?.id===d&&(s.value=w.data),w.data}catch(w){throw c.value=w.response?.data?.message||"Failed to update contact",w}finally{r.value=!1}}async function v(d){const u=$();if(!u.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{await T.delete(u.currentOrganization.id,d),o.value=o.value.filter(n=>n.id!==d),z.value-=1,s.value?.id===d&&(s.value=null)}catch(n){throw c.value=n.response?.data?.message||"Failed to delete contact",n}finally{r.value=!1}}async function k(d){const u=$();if(!u.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{await T.bulkDelete(u.currentOrganization.id,d),o.value=o.value.filter(n=>!d.includes(n.id)),z.value-=d.length}catch(n){throw c.value=n.response?.data?.message||"Failed to delete contacts",n}finally{r.value=!1}}async function P(d,u){const n=$();if(!n.currentOrganization?.id)throw new Error("No organization selected");r.value=!0,c.value=null;try{await T.bulkTag(n.currentOrganization.id,d,u),o.value.forEach(w=>{if(d.includes(w.id)){const O=w.tags||[];w.tags=[...new Set([...O,...u])]}})}catch(w){throw c.value=w.response?.data?.message||"Failed to tag contacts",w}finally{r.value=!1}}return{contacts:o,currentContact:s,loading:r,error:c,total:z,page:g,perPage:_,fetchContacts:A,fetchContact:M,createContact:x,updateContact:l,deleteContact:v,bulkDelete:k,bulkTag:P}}),Ut={class:"space-y-6 relative min-h-screen pb-20"},Yt={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},qt={class:"text-slate-500 mt-1"},Qt={class:"flex gap-3"},Rt={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4"},Ht={class:"relative"},Kt={class:"flex flex-wrap gap-3 items-center"},Xt={class:"relative"},Gt={key:0,class:"text-center py-12"},Jt={key:1,class:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden"},Wt={class:"overflow-x-auto"},Zt={class:"w-full text-sm text-left"},te={class:"bg-slate-50 text-slate-500 font-medium border-b border-slate-200"},ee={class:"px-6 py-3 w-10"},se=["checked"],oe={class:"px-6 py-3 cursor-pointer hover:text-[#1B4F72] group"},ae={class:"flex items-center gap-1"},ne={class:"divide-y divide-slate-100"},le=["onClick"],re=["checked","onChange"],ie={class:"px-6 py-4 font-medium text-slate-900"},de={class:"flex items-center gap-3"},ce={class:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500"},ue={class:"px-6 py-4 text-slate-500 font-mono text-xs"},fe={class:"px-6 py-4 text-slate-500"},pe={class:"px-6 py-4"},ge={class:"flex flex-wrap gap-1"},ve={class:"px-6 py-4 text-slate-500"},xe=["onClick"],me={key:0},be={class:"px-6 py-4 border-t border-slate-200 flex items-center justify-between"},he={class:"text-sm text-slate-500"},ye={class:"flex gap-2"},we=["disabled"],ze=["disabled"],Ce={key:2,class:"fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#1B4F72] text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-6 z-30"},ke={class:"font-medium"},$e={class:"flex gap-2"},Ne=q({__name:"ContactsPage",setup(o){const s=Lt(),r=$(),c=h(""),z=h(""),g=h([]),_=h(!1),A=h(!1),M=h(!1),x=W(()=>c.value||z.value);function l(m){if(!m)return"Never";const e=new Date(m),F=new Date().getTime()-e.getTime(),B=Math.floor(F/(1e3*60*60*24));return B===0?"Today":B===1?"Yesterday":B<7?`${B} days ago`:B<30?`${Math.floor(B/7)} weeks ago`:`${Math.floor(B/30)} months ago`}function v(){g.value.length===s.contacts.length?g.value=[]:g.value=s.contacts.map(m=>m.id)}function k(m){const e=g.value.indexOf(m);e>-1?g.value.splice(e,1):g.value.push(m)}const P=h(null),d=h(!1);function u(m){P.value=m,d.value=!0}const n=mt(()=>{N()},300);function w(){N()}function O(){c.value="",z.value="",N()}function I(m){N({page:m})}async function N(m){try{await s.fetchContacts({search:c.value||void 0,status:z.value||void 0,...m})}catch(e){console.error("Failed to fetch contacts:",e)}}async function X(){if(confirm(`Delete ${g.value.length} contacts?`))try{await s.bulkDelete(g.value),g.value=[],await N()}catch(m){console.error("Failed to delete contacts:",m)}}return Z(async()=>{try{r.currentOrganization||(await r.fetchOrganizations(),r.organizations.length>0&&r.setCurrentOrganization(r.organizations[0])),r.currentOrganization?.id&&await N()}catch(m){console.error("Failed to load contacts:",m)}}),(m,e)=>(b(),tt(ot,null,{default:et(()=>[t("div",Ut,[t("div",Yt,[t("div",null,[e[12]||(e[12]=t("h1",{class:"text-3xl font-heading font-bold text-[#1B4F72]"}," Contacts ",-1)),t("p",qt,f(a(s).total)+" total contacts",1)]),t("div",Qt,[t("button",{onClick:e[0]||(e[0]=i=>A.value=!0),class:"px-4 py-2.5 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2"},[p(a(dt),{size:18}),e[13]||(e[13]=C(" Import ",-1))]),t("button",{onClick:e[1]||(e[1]=i=>_.value=!0),class:"px-4 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2"},[p(a(K),{size:18}),e[14]||(e[14]=C(" Add Contact ",-1))])])]),t("div",Rt,[t("div",Ht,[p(a(ct),{class:"absolute left-3 top-3 text-slate-400",size:20}),U(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>c.value=i),type:"text",placeholder:"Search contacts by name, phone, email...",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72]",onInput:e[3]||(e[3]=(...i)=>a(n)&&a(n)(...i))},null,544),[[Q,c.value]])]),t("div",Kt,[t("div",Xt,[U(t("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>z.value=i),class:"appearance-none pl-3 pr-8 py-1.5 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] cursor-pointer hover:bg-slate-50",onChange:w},[...e[15]||(e[15]=[t("option",{value:""},"Status: All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1)])],544),[[st,z.value]]),p(a(ut),{class:"absolute right-2.5 top-2 text-slate-400 pointer-events-none",size:12})]),x.value?(b(),y("button",{key:0,onClick:O,class:"text-sm text-slate-400 hover:text-[#1B4F72]"}," Clear filters ")):D("",!0)])]),a(s).loading?(b(),y("div",Gt,[...e[16]||(e[16]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4F72]"},null,-1),t("p",{class:"mt-4 text-slate-500"},"Loading contacts...",-1)])])):(b(),y("div",Jt,[t("div",Wt,[t("table",Zt,[t("thead",te,[t("tr",null,[t("th",ee,[t("input",{type:"checkbox",class:"rounded border-slate-300 text-[#1B4F72] focus:ring-[#1B4F72]",checked:g.value.length===a(s).contacts.length&&a(s).contacts.length>0,onChange:v},null,40,se)]),t("th",oe,[t("div",ae,[e[17]||(e[17]=C(" Name ",-1)),p(a(ft),{size:12,class:"opacity-0 group-hover:opacity-100"})])]),e[18]||(e[18]=t("th",{class:"px-6 py-3"},"Phone",-1)),e[19]||(e[19]=t("th",{class:"px-6 py-3"},"Email",-1)),e[20]||(e[20]=t("th",{class:"px-6 py-3"},"Tags",-1)),e[21]||(e[21]=t("th",{class:"px-6 py-3"},"Last Contact",-1)),e[22]||(e[22]=t("th",{class:"px-6 py-3 text-right"},"Actions",-1))])]),t("tbody",ne,[(b(!0),y(E,null,V(a(s).contacts,i=>(b(),y("tr",{key:i.id,class:L(["hover:bg-slate-50 transition-colors cursor-pointer",g.value.includes(i.id)?"bg-blue-50/30":""]),onClick:F=>u(i)},[t("td",{class:"px-6 py-4",onClick:e[5]||(e[5]=j(()=>{},["stop"]))},[t("input",{type:"checkbox",class:"rounded border-slate-300 text-[#1B4F72] focus:ring-[#1B4F72]",checked:g.value.includes(i.id),onChange:F=>k(i.id)},null,40,re)]),t("td",ie,[t("div",de,[t("div",ce,f(i.first_name.charAt(0)),1),C(" "+f(i.first_name)+" "+f(i.last_name||""),1)])]),t("td",ue,f(i.phone||"-"),1),t("td",fe,f(i.email||"-"),1),t("td",pe,[t("div",ge,[(b(!0),y(E,null,V(i.tags||[],F=>(b(),y("span",{key:F,class:"px-2 py-0.5 rounded-full bg-slate-100 text-slate-600 text-xs font-medium border border-slate-200"},f(F),1))),128))])]),t("td",ve,f(l(i.last_contacted_at)),1),t("td",{class:"px-6 py-4 text-right",onClick:e[6]||(e[6]=j(()=>{},["stop"]))},[t("button",{onClick:j(F=>u(i),["stop"]),class:"p-1 text-slate-400 hover:text-[#1B4F72] rounded hover:bg-slate-100"},[p(a(pt),{size:16})],8,xe)])],10,le))),128)),a(s).contacts.length===0?(b(),y("tr",me,[...e[23]||(e[23]=[t("td",{colspan:"7",class:"px-6 py-8 text-center text-slate-500"}," No contacts found ",-1)])])):D("",!0)])])]),t("div",be,[t("span",he," Showing "+f((a(s).page-1)*a(s).perPage+1)+"- "+f(Math.min(a(s).page*a(s).perPage,a(s).total))+" of "+f(a(s).total),1),t("div",ye,[t("button",{disabled:a(s).page===1,onClick:e[7]||(e[7]=i=>I(a(s).page-1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-50"},[p(a(gt),{size:16})],8,we),t("button",{disabled:a(s).page*a(s).perPage>=a(s).total,onClick:e[8]||(e[8]=i=>I(a(s).page+1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50"},[p(a(vt),{size:16})],8,ze)])])])),g.value.length>0?(b(),y("div",Ce,[t("span",ke,f(g.value.length)+" contacts selected ",1),e[26]||(e[26]=t("div",{class:"h-4 w-px bg-white/20"},null,-1)),t("div",$e,[t("button",{onClick:X,class:"px-3 py-1.5 hover:bg-white/10 rounded-md transition-colors flex items-center gap-2 text-sm"},[p(a(xt),{size:16}),e[24]||(e[24]=C(" Delete ",-1))]),t("button",{onClick:e[9]||(e[9]=i=>M.value=!0),class:"px-3 py-1.5 hover:bg-white/10 rounded-md transition-colors flex items-center gap-2 text-sm"},[p(a(H),{size:16}),e[25]||(e[25]=C(" Add Tag ",-1))])]),t("button",{onClick:e[10]||(e[10]=i=>g.value=[]),class:"ml-2 p-1 hover:bg-white/10 rounded-full"},[p(a(R),{size:16})])])):D("",!0)]),p(jt,{contact:P.value,"is-open":d.value,onClose:e[11]||(e[11]=i=>d.value=!1)},null,8,["contact","is-open"])]),_:1}))}});export{Ne as default};
