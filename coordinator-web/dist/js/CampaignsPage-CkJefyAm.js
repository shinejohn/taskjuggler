import{_ as E}from"./DashboardLayout.vue_vue_type_script_setup_true_lang--joD49fW.js";import{d as R,r as x,a as q,N as M,o as T,b as U,w as Y,p as t,m as v,s as A,v as F,u as k,x as P,n as O,y as c,c as j,F as L,q as $,Z,f as p}from"./vue-vendor-lZgBCM-Y.js";import{a as h}from"./index-BdtiHmgt.js";import{useOrganizationsStore as _}from"./organizations-B-TbRSUr.js";import{b as G}from"./status-DdzIA5VN.js";import{aa as H,ao as J,as as K}from"./ui-vendor-XL1sGzTt.js";import"./utils-vendor-B9ygI19o.js";const y={getAll(r,o){return h.get(`/coordinator/organizations/${r}/campaigns`,{params:o})},getById(r,o){return h.get(`/coordinator/organizations/${r}/campaigns/${o}`)},create(r,o){return h.post(`/coordinator/organizations/${r}/campaigns`,o)},update(r,o,n){return h.put(`/coordinator/organizations/${r}/campaigns/${o}`,n)},delete(r,o){return h.delete(`/coordinator/organizations/${r}/campaigns/${o}`)},start(r,o){return h.post(`/coordinator/organizations/${r}/campaigns/${o}/start`)},pause(r,o){return h.post(`/coordinator/organizations/${r}/campaigns/${o}/pause`)},getStats(r,o){return h.get(`/coordinator/organizations/${r}/campaigns/${o}/stats`)}},Q=R("campaigns",()=>{const r=x([]),o=x(null),n=x(!1),l=x(null),S=x(0),C=x(1),b=x(15);async function B(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{const a=await y.getAll(u,{...d,page:d?.page||C.value,per_page:d?.per_page||b.value}),i=a.data.data||a.data;r.value=Array.isArray(i)?i:i.data,S.value=a.data.total||(i.meta?i.meta.total:i.length),C.value=a.data.page||(i.meta?i.meta.current_page:C.value),b.value=a.data.per_page||(i.meta?i.meta.per_page:b.value)}catch(a){throw l.value=a.response?.data?.message||"Failed to load campaigns",a}finally{n.value=!1}}async function N(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{const a=await y.getById(u,d),i=a.data.data||a.data;return o.value=i,i}catch(a){throw l.value=a.response?.data?.message||"Failed to load campaign",a}finally{n.value=!1}}async function I(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{const a=await y.create(u,d),i=a.data.data||a.data;return r.value.push(i),i}catch(a){throw l.value=a.response?.data?.message||"Failed to create campaign",console.error("Campaign creation error:",a),a}finally{n.value=!1}}async function D(d,g){n.value=!0,l.value=null;const a=_().currentOrganization?.id;if(!a){l.value="No organization selected.",n.value=!1;return}try{const i=await y.update(a,d,g),m=i.data.data||i.data,z=r.value.findIndex(V=>V.id===d);return z!==-1&&(r.value[z]=m),o.value?.id===d&&(o.value=m),m}catch(i){throw l.value=i.response?.data?.message||"Failed to update campaign",console.error("Campaign update error:",i),i}finally{n.value=!1}}async function f(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{await y.delete(u,d),r.value=r.value.filter(a=>a.id!==d),o.value?.id===d&&(o.value=null)}catch(a){throw l.value=a.response?.data?.message||"Failed to delete campaign",console.error("Campaign deletion error:",a),a}finally{n.value=!1}}async function s(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{const a=await y.start(u,d),i=a.data.data||a.data,m=r.value.findIndex(z=>z.id===d);return m!==-1&&(r.value[m]=i),i}catch(a){throw l.value=a.response?.data?.message||"Failed to start campaign",console.error("Campaign start error:",a),a}finally{n.value=!1}}async function e(d){n.value=!0,l.value=null;const u=_().currentOrganization?.id;if(!u){l.value="No organization selected.",n.value=!1;return}try{const a=await y.pause(u,d),i=a.data.data||a.data,m=r.value.findIndex(z=>z.id===d);return m!==-1&&(r.value[m]=i),i}catch(a){throw l.value=a.response?.data?.message||"Failed to pause campaign",console.error("Campaign pause error:",a),a}finally{n.value=!1}}return{campaigns:r,currentCampaign:o,loading:n,error:l,total:S,page:C,perPage:b,fetchCampaigns:B,fetchCampaign:N,createCampaign:I,updateCampaign:D,deleteCampaign:f,startCampaign:s,pauseCampaign:e,filteredCampaigns:d=>!d||d==="all"?r.value:r.value.filter(g=>g.status===d)}}),W={class:"space-y-6"},X={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},tt={class:"border-b border-slate-200"},et={class:"flex space-x-8"},at=["onClick"],st={key:0,class:"text-center py-12"},ot={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},nt={class:"p-6 border-b border-slate-100"},rt={class:"flex justify-between items-start mb-2"},lt={class:"text-lg font-bold text-slate-900"},it={class:"text-sm text-slate-500"},dt={key:0,class:"flex items-center gap-2 mt-2"},ut={class:"w-6 h-6 rounded-full bg-blue-100 text-[#1B4F72] flex items-center justify-center text-xs font-bold"},ct={class:"text-xs text-slate-500"},gt={class:"p-6"},pt={key:0,class:"space-y-4"},vt={class:"flex justify-between text-sm mb-2"},ft={class:"font-medium text-slate-900"},mt={class:"h-2 bg-slate-200 rounded-full overflow-hidden"},xt={class:"grid grid-cols-3 gap-4 text-center"},ht={class:"text-lg font-bold text-slate-900"},_t={class:"text-lg font-bold text-green-600"},bt={class:"text-lg font-bold text-amber-600"},yt={key:1,class:"space-y-3"},Ct={class:"text-sm text-slate-600"},wt={key:2,class:"text-sm text-slate-600"},zt={class:"mt-2"},St={key:3,class:"text-sm text-slate-500"},kt={class:"flex gap-2 mt-6 pt-4 border-t border-slate-100"},Ft=["onClick"],$t=["onClick"],Bt=["onClick"],Nt={key:0,class:"lg:col-span-2 text-center py-12 bg-white rounded-xl border border-slate-200"},Vt=q({__name:"CampaignsPage",setup(r){const o=Q(),n=_(),l=x("all"),S=x(!1),C=j(()=>{const f=o.campaigns.length,s=o.campaigns.filter(g=>g.status==="running").length,e=o.campaigns.filter(g=>g.status==="scheduled").length,w=o.campaigns.filter(g=>g.status==="completed").length,d=o.campaigns.filter(g=>g.status==="draft").length;return[{id:"all",label:"All",count:f},{id:"running",label:"Active",count:s},{id:"scheduled",label:"Scheduled",count:e},{id:"completed",label:"Completed",count:w},{id:"draft",label:"Drafts",count:d}]}),b=j(()=>o.filteredCampaigns(l.value==="all"?void 0:l.value));M(l,async f=>{n.currentOrganization&&await o.fetchCampaigns(f==="all"?{}:{status:f})});const B=G;async function N(f){try{await o.pauseCampaign(f.id)}catch(s){console.error("Failed to pause campaign:",s)}}function I(f){}function D(f){}return T(async()=>{n.currentOrganization||(await n.fetchOrganizations(),n.organizations.length>0&&n.setCurrentOrganization(n.organizations[0])),n.currentOrganization&&await o.fetchCampaigns()}),(f,s)=>(p(),U(E,null,{default:Y(()=>[t("div",W,[t("div",X,[s[3]||(s[3]=t("div",null,[t("h1",{class:"text-3xl font-heading font-bold text-[#1B4F72]"}," Campaigns "),t("p",{class:"text-slate-500 mt-1"}," Automated outreach powered by your 4 Calls ")],-1)),t("button",{onClick:s[0]||(s[0]=e=>S.value=!0),class:"px-5 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2"},[A(k(H),{size:18}),s[2]||(s[2]=F(" Create Campaign ",-1))])]),t("div",tt,[t("nav",et,[(p(!0),v(L,null,P(C.value,e=>(p(),v("button",{key:e.id,onClick:w=>l.value=e.id,class:O(["py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",l.value===e.id?"border-[#1B4F72] text-[#1B4F72]":"border-transparent text-slate-500 hover:text-[#1B4F72] hover:border-slate-300"])},[F(c(e.label)+" ",1),t("span",{class:O(["px-2 py-0.5 rounded-full text-xs font-medium",l.value===e.id?"bg-blue-100 text-[#1B4F72]":"bg-slate-100 text-slate-500"])},c(e.count),3)],10,at))),128))])]),k(o).loading?(p(),v("div",st,[...s[4]||(s[4]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4F72]"},null,-1),t("p",{class:"mt-4 text-slate-500"},"Loading campaigns...",-1)])])):(p(),v("div",ot,[(p(!0),v(L,null,P(b.value,e=>(p(),v("div",{key:e.id,class:"bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow overflow-hidden"},[t("div",nt,[t("div",rt,[t("div",null,[t("h3",lt,c(e.name),1),t("p",it,c(e.type),1),e.coordinator?(p(),v("div",dt,[t("div",ut,c(e.coordinator.display_name?.charAt(0)||"C"),1),t("span",ct,c(e.coordinator.display_name),1)])):$("",!0)]),t("span",{class:O(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",k(B)(e.status)])},c(e.status.charAt(0).toUpperCase()+e.status.slice(1)),3)])]),t("div",gt,[e.status==="running"?(p(),v("div",pt,[t("div",null,[t("div",vt,[s[5]||(s[5]=t("span",{class:"text-slate-600"},"Progress",-1)),t("span",ft,c(e.contacts_processed||0)+" / "+c(e.target_count||0),1)]),t("div",mt,[t("div",{class:"h-full bg-[#1B4F72] rounded-full transition-all",style:Z({width:`${(e.contacts_processed||0)/(e.target_count||1)*100}%`})},null,4)])]),t("div",xt,[t("div",null,[t("div",ht,c(e.answer_rate||0)+"%",1),s[6]||(s[6]=t("div",{class:"text-xs text-slate-500"},"Answer Rate",-1))]),t("div",null,[t("div",_t,c(e.confirmation_rate||0)+"%",1),s[7]||(s[7]=t("div",{class:"text-xs text-slate-500"},"Confirmed",-1))]),t("div",null,[t("div",bt,c(e.appointments_rescheduled||0),1),s[8]||(s[8]=t("div",{class:"text-xs text-slate-500"},"Rescheduled",-1))])])])):e.status==="completed"?(p(),v("div",yt,[t("div",Ct,[s[9]||(s[9]=t("div",{class:"font-medium text-slate-900 mb-2"},"Final Results",-1)),t("div",null,"Contacted: "+c(e.contacts_contacted||0),1),t("div",null,"Answered: "+c(e.contacts_answered||0),1),t("div",null,"Appointments: "+c(e.appointments_booked||0),1)])])):e.status==="scheduled"?(p(),v("div",wt,[s[10]||(s[10]=t("div",{class:"font-medium text-slate-900 mb-1"},"Starts",-1)),t("div",null,c(e.scheduled_start_at?new Date(e.scheduled_start_at).toLocaleString():"Not set"),1),t("div",zt,"Target: "+c(e.target_count||0)+" contacts",1)])):(p(),v("div",St," Last edited "+c(e.updated_at?new Date(e.updated_at).toLocaleDateString():"Never"),1)),t("div",kt,[e.status==="running"?(p(),v("button",{key:0,onClick:w=>N(e),class:"flex-1 py-2 px-3 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center justify-center gap-2"},[A(k(J),{size:16}),s[11]||(s[11]=F(" Pause ",-1))],8,Ft)):$("",!0),e.status==="draft"?(p(),v("button",{key:1,onClick:w=>void 0,class:"flex-1 py-2 px-3 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center justify-center gap-2"},[A(k(K),{size:16}),s[12]||(s[12]=F(" Edit ",-1))],8,$t)):$("",!0),t("button",{onClick:w=>void 0,class:"flex-1 py-2 px-3 bg-[#1B4F72] text-white font-medium rounded-lg hover:bg-[#153e5a] transition-colors"}," View Details ",8,Bt)])])]))),128)),b.value.length===0?(p(),v("div",Nt,[s[13]||(s[13]=t("p",{class:"text-slate-500 mb-4"},"No campaigns found",-1)),t("button",{onClick:s[1]||(s[1]=e=>S.value=!0),class:"px-5 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg"}," Create Your First Campaign ")])):$("",!0)]))])]),_:1}))}});export{Vt as default};
