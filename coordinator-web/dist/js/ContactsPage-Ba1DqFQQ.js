import{a as q,N as J,m as w,q as D,p as t,y as g,s as v,u as a,v as k,F as I,x as j,r as y,n as L,D as U,I as Q,f as h,d as K,o as W,b as Z,w as tt,a4 as et,c as st,A as V}from"./vue-vendor-lZgBCM-Y.js";import{_ as ot}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-B_Gh6zTT.js";import{X as R,z as at,a5 as Y,h as nt,ah as X,aa as G,c as lt,ai as rt,m as it,aj as dt,ae as ct,af as ut,ak as ft,ag as pt,al as gt,am as vt,an as xt}from"./ui-vendor-XL1sGzTt.js";import{a as T}from"./index-DMcm1eEm.js";import{useOrganizationsStore as F}from"./organizations-CeoK_ZQ2.js";import{c as mt}from"./request-t1OiQL2I.js";import"./utils-vendor-D5GkNzM3.js";const bt={class:"sticky top-0 bg-white border-b border-slate-100 p-6 flex justify-between items-start z-10"},ht={class:"flex items-center gap-4"},yt={class:"w-12 h-12 rounded-full bg-blue-50 text-[#1B4F72] flex items-center justify-center text-xl font-bold"},wt={class:"text-xl font-bold text-slate-900"},zt={class:"text-sm text-slate-500"},kt={key:0,class:"p-6 space-y-8"},Ct={class:"space-y-4"},$t={class:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100"},_t={class:"flex items-center gap-3"},Ft={class:"font-mono text-sm font-medium text-slate-700"},Bt={class:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100"},St={class:"flex items-center gap-3"},At={class:"text-sm font-medium text-slate-700"},Tt={class:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2"},Ot={class:"flex flex-wrap gap-2"},Nt={class:"text-sm font-bold text-slate-900 mb-4 flex items-center gap-2"},Dt={class:"space-y-4 relative pl-2"},Mt={class:"text-xs font-bold text-slate-400 mb-1"},Et={class:"font-medium text-slate-900"},It={class:"text-xs text-slate-500"},Pt={key:0,class:"text-sm text-slate-500 pl-6"},jt={class:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2"},Vt=q({__name:"ContactSidebar",props:{contact:{},isOpen:{type:Boolean}},emits:["close"],setup(o){const s=o,i=y(""),u=y(!1),z=y([{type:"call",date:"Today, 10:42 AM",desc:"Appointment Booked",by:"Sally"},{type:"appointment",date:"Yesterday, 2:15 PM",desc:"Service Call Completed",by:"Ed"}]);J(()=>s.contact,m=>{m&&(i.value=m.notes||"")});function f(m){if(!m)return"Recently";const l=new Date(m),C=Math.floor((new Date().getTime()-l.getTime())/(1e3*60*60*24));return C===0?"Today":C===1?"Yesterday":C<7?`${C} days ago`:l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function $(m){return{call:"bg-blue-500",appointment:"bg-green-500",message:"bg-purple-500",note:"bg-amber-500"}[m]||"bg-slate-400"}function N(m){m&&m!=="N/A"&&navigator.clipboard.writeText(m)}function M(){}return(m,l)=>(h(),w(I,null,[o.isOpen?(h(),w("div",{key:0,class:"fixed inset-0 bg-black/20 z-40 transition-opacity",onClick:l[0]||(l[0]=x=>m.$emit("close"))})):D("",!0),t("div",{class:L(["fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out overflow-y-auto",o.isOpen?"translate-x-0":"translate-x-full"])},[t("div",bt,[t("div",ht,[t("div",yt,g(o.contact?.first_name?.charAt(0)||"?"),1),t("div",null,[t("h2",wt,g(o.contact?.first_name)+" "+g(o.contact?.last_name||""),1),t("p",zt," Added "+g(f(o.contact?.created_at)),1)])]),t("button",{onClick:l[1]||(l[1]=x=>m.$emit("close")),class:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors"},[v(a(R),{size:20})])]),o.contact?(h(),w("div",kt,[t("section",Ct,[t("div",$t,[t("div",_t,[v(a(at),{size:18,class:"text-slate-400"}),t("span",Ft,g(o.contact.phone||"N/A"),1)]),t("button",{onClick:l[2]||(l[2]=x=>o.contact.phone?N(o.contact.phone):void 0),class:"text-slate-400 hover:text-[#1B4F72]"},[v(a(Y),{size:14})])]),t("div",Bt,[t("div",St,[v(a(nt),{size:18,class:"text-slate-400"}),t("span",At,g(o.contact.email||"N/A"),1)]),t("button",{onClick:l[3]||(l[3]=x=>o.contact.email?N(o.contact.email):void 0),class:"text-slate-400 hover:text-[#1B4F72]"},[v(a(Y),{size:14})])])]),t("section",null,[t("h3",Tt,[v(a(X),{size:16,class:"text-slate-400"}),l[6]||(l[6]=k(" Tags ",-1))]),t("div",Ot,[(h(!0),w(I,null,j(o.contact.tags||[],x=>(h(),w("span",{key:x,class:"px-2.5 py-1 rounded-full bg-blue-50 text-[#1B4F72] text-xs font-medium border border-blue-100"},g(x),1))),128)),t("button",{onClick:l[4]||(l[4]=x=>u.value=!0),class:"px-2.5 py-1 rounded-full border border-dashed border-slate-300 text-slate-500 text-xs font-medium hover:border-[#1B4F72] hover:text-[#1B4F72] flex items-center gap-1 transition-colors"},[v(a(G),{size:12}),l[7]||(l[7]=k(" Add ",-1))])])]),t("section",null,[t("h3",Nt,[v(a(lt),{size:16,class:"text-slate-400"}),l[8]||(l[8]=k(" Interaction Timeline ",-1))]),t("div",Dt,[l[9]||(l[9]=t("div",{class:"absolute left-[5px] top-2 bottom-2 w-0.5 bg-slate-100"},null,-1)),(h(!0),w(I,null,j(z.value,(x,C)=>(h(),w("div",{key:C,class:"relative pl-6"},[t("div",{class:L(["absolute left-0 top-1 w-3 h-3 rounded-full border-2 border-white",$(x.type)])},null,2),t("div",Mt,g(x.date),1),t("div",Et,g(x.desc),1),t("div",It,"by "+g(x.by),1)]))),128)),z.value.length===0?(h(),w("div",Pt," No interactions yet ")):D("",!0)])]),t("section",null,[t("h3",jt,[v(a(rt),{size:16,class:"text-slate-400"}),l[10]||(l[10]=k(" Notes ",-1))]),U(t("textarea",{"onUpdate:modelValue":l[5]||(l[5]=x=>i.value=x),class:"w-full p-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] min-h-[100px]",placeholder:"Add a note about this contact..."},null,512),[[Q,i.value]]),t("button",{onClick:M,class:"mt-2 px-4 py-2 bg-[#1B4F72] text-white rounded-lg hover:bg-[#153e5a] transition-colors flex items-center gap-2"},[v(a(it),{size:16}),l[11]||(l[11]=k(" Save Note ",-1))])])])):D("",!0)],2)],64))}}),O={getAll:(o,s)=>T.get(`/coordinator/organizations/${o}/contacts`,{params:s}),getById:(o,s)=>T.get(`/coordinator/organizations/${o}/contacts/${s}`),create:(o,s)=>T.post(`/coordinator/organizations/${o}/contacts`,s),update:(o,s,i)=>T.put(`/coordinator/organizations/${o}/contacts/${s}`,i),delete:(o,s)=>T.delete(`/coordinator/organizations/${o}/contacts/${s}`),bulkDelete:(o,s)=>T.post(`/coordinator/organizations/${o}/contacts/bulk-delete`,{ids:s}),bulkTag:(o,s,i)=>T.post(`/coordinator/organizations/${o}/contacts/bulk-tag`,{ids:s,tags:i})},Lt=K("contacts",()=>{const o=y([]),s=y(null),i=y(!1),u=y(null),z=y(0),f=y(1),$=y(15);async function N(c){const p=F();if(!p.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{const n=await O.getAll(p.currentOrganization.id,{...c,page:c?.page||f.value,per_page:c?.per_page||$.value}),r=n.data.data||n.data;o.value=Array.isArray(r)?r:r.data,z.value=n.data.total||(r.meta?r.meta.total:r.length),f.value=n.data.page||(r.meta?r.meta.current_page:f.value),$.value=n.data.per_page||(r.meta?r.meta.per_page:$.value)}catch(n){throw u.value=n.response?.data?.message||"Failed to load contacts",n}finally{i.value=!1}}async function M(c){const p=F();if(!p.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{const n=await O.getById(p.currentOrganization.id,c),r=n.data.data||n.data;return s.value=r,r}catch(n){throw u.value=n.response?.data?.message||"Failed to load contact",n}finally{i.value=!1}}async function m(c){const p=F();if(!p.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{const n=await O.create(p.currentOrganization.id,c),r=n.data.data||n.data;return o.value.unshift(r),z.value+=1,r}catch(n){throw u.value=n.response?.data?.message||"Failed to create contact",n}finally{i.value=!1}}async function l(c,p){const n=F();if(!n.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{const r=await O.update(n.currentOrganization.id,c,p),B=r.data.data||r.data,E=o.value.findIndex(_=>_.id===c);return E!==-1&&(o.value[E]=B),s.value?.id===c&&(s.value=B),B}catch(r){throw u.value=r.response?.data?.message||"Failed to update contact",r}finally{i.value=!1}}async function x(c){const p=F();if(!p.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{await O.delete(p.currentOrganization.id,c),o.value=o.value.filter(n=>n.id!==c),z.value-=1,s.value?.id===c&&(s.value=null)}catch(n){throw u.value=n.response?.data?.message||"Failed to delete contact",n}finally{i.value=!1}}async function C(c){const p=F();if(!p.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{await O.bulkDelete(p.currentOrganization.id,c),o.value=o.value.filter(n=>!c.includes(n.id)),z.value-=c.length}catch(n){throw u.value=n.response?.data?.message||"Failed to delete contacts",n}finally{i.value=!1}}async function P(c,p){const n=F();if(!n.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,u.value=null;try{await O.bulkTag(n.currentOrganization.id,c,p),o.value.forEach(r=>{if(c.includes(r.id)){const B=r.tags||[];r.tags=[...new Set([...B,...p])]}})}catch(r){throw u.value=r.response?.data?.message||"Failed to tag contacts",r}finally{i.value=!1}}return{contacts:o,currentContact:s,loading:i,error:u,total:z,page:f,perPage:$,fetchContacts:N,fetchContact:M,createContact:m,updateContact:l,deleteContact:x,bulkDelete:C,bulkTag:P}}),Ut={class:"space-y-6 relative min-h-screen pb-20"},Yt={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},qt={class:"text-slate-500 mt-1"},Qt={class:"flex gap-3"},Rt={class:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4"},Xt={class:"relative"},Gt={class:"flex flex-wrap gap-3 items-center"},Ht={class:"relative"},Jt={key:0,class:"text-center py-12"},Kt={key:1,class:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden"},Wt={class:"overflow-x-auto"},Zt={class:"w-full text-sm text-left"},te={class:"bg-slate-50 text-slate-500 font-medium border-b border-slate-200"},ee={class:"px-6 py-3 w-10"},se=["checked"],oe={class:"px-6 py-3 cursor-pointer hover:text-[#1B4F72] group"},ae={class:"flex items-center gap-1"},ne={class:"divide-y divide-slate-100"},le=["onClick"],re=["checked","onChange"],ie={class:"px-6 py-4 font-medium text-slate-900"},de={class:"flex items-center gap-3"},ce={class:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500"},ue={class:"px-6 py-4 text-slate-500 font-mono text-xs"},fe={class:"px-6 py-4 text-slate-500"},pe={class:"px-6 py-4"},ge={class:"flex flex-wrap gap-1"},ve={class:"px-6 py-4 text-slate-500"},xe=["onClick"],me={key:0},be={class:"px-6 py-4 border-t border-slate-200 flex items-center justify-between"},he={class:"text-sm text-slate-500"},ye={class:"flex gap-2"},we=["disabled"],ze=["disabled"],ke={key:2,class:"fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#1B4F72] text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-6 z-30"},Ce={class:"font-medium"},$e={class:"flex gap-2"},Ne=q({__name:"ContactsPage",setup(o){const s=Lt(),i=F(),u=y(""),z=y(""),f=y([]),$=y(!1),N=y(!1),M=y(!1),m=st(()=>u.value||z.value);function l(b){if(!b)return"Never";const e=new Date(b),S=new Date().getTime()-e.getTime(),A=Math.floor(S/(1e3*60*60*24));return A===0?"Today":A===1?"Yesterday":A<7?`${A} days ago`:A<30?`${Math.floor(A/7)} weeks ago`:`${Math.floor(A/30)} months ago`}function x(){f.value.length===s.contacts.length?f.value=[]:f.value=s.contacts.map(b=>b.id)}function C(b){const e=f.value.indexOf(b);e>-1?f.value.splice(e,1):f.value.push(b)}const P=y(null),c=y(!1);function p(b){P.value=b,c.value=!0}const n=mt(()=>{_()},300);function r(){_()}function B(){u.value="",z.value="",_()}function E(b){_({page:b})}async function _(b){try{await s.fetchContacts({search:u.value||void 0,status:z.value||void 0,...b})}catch(e){console.error("Failed to fetch contacts:",e)}}async function H(){if(confirm(`Delete ${f.value.length} contacts?`))try{await s.bulkDelete(f.value),f.value=[],await _()}catch(b){console.error("Failed to delete contacts:",b)}}return W(async()=>{try{i.currentOrganization||(await i.fetchOrganizations(),i.organizations.length>0&&i.setCurrentOrganization(i.organizations[0])),i.currentOrganization?.id&&await _()}catch(b){console.error("Failed to load contacts:",b)}}),(b,e)=>(h(),Z(ot,null,{default:tt(()=>[t("div",Ut,[t("div",Yt,[t("div",null,[e[12]||(e[12]=t("h1",{class:"text-3xl font-heading font-bold text-[#1B4F72]"}," Contacts ",-1)),t("p",qt,g(a(s).total)+" total contacts",1)]),t("div",Qt,[t("button",{onClick:e[0]||(e[0]=d=>N.value=!0),class:"px-4 py-2.5 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2"},[v(a(dt),{size:18}),e[13]||(e[13]=k(" Import ",-1))]),t("button",{onClick:e[1]||(e[1]=d=>$.value=!0),class:"px-4 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2"},[v(a(G),{size:18}),e[14]||(e[14]=k(" Add Contact ",-1))])])]),t("div",Rt,[t("div",Xt,[v(a(ct),{class:"absolute left-3 top-3 text-slate-400",size:20}),U(t("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>u.value=d),type:"text",placeholder:"Search contacts by name, phone, email...",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72]",onInput:e[3]||(e[3]=(...d)=>a(n)&&a(n)(...d))},null,544),[[Q,u.value]])]),t("div",Gt,[t("div",Ht,[U(t("select",{"onUpdate:modelValue":e[4]||(e[4]=d=>z.value=d),class:"appearance-none pl-3 pr-8 py-1.5 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#1B4F72]/20 focus:border-[#1B4F72] cursor-pointer hover:bg-slate-50",onChange:r},[...e[15]||(e[15]=[t("option",{value:""},"Status: All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1)])],544),[[et,z.value]]),v(a(ut),{class:"absolute right-2.5 top-2 text-slate-400 pointer-events-none",size:12})]),m.value?(h(),w("button",{key:0,onClick:B,class:"text-sm text-slate-400 hover:text-[#1B4F72]"}," Clear filters ")):D("",!0)])]),a(s).loading?(h(),w("div",Jt,[...e[16]||(e[16]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4F72]"},null,-1),t("p",{class:"mt-4 text-slate-500"},"Loading contacts...",-1)])])):(h(),w("div",Kt,[t("div",Wt,[t("table",Zt,[t("thead",te,[t("tr",null,[t("th",ee,[t("input",{type:"checkbox",class:"rounded border-slate-300 text-[#1B4F72] focus:ring-[#1B4F72]",checked:f.value.length===a(s).contacts.length&&a(s).contacts.length>0,onChange:x},null,40,se)]),t("th",oe,[t("div",ae,[e[17]||(e[17]=k(" Name ",-1)),v(a(ft),{size:12,class:"opacity-0 group-hover:opacity-100"})])]),e[18]||(e[18]=t("th",{class:"px-6 py-3"},"Phone",-1)),e[19]||(e[19]=t("th",{class:"px-6 py-3"},"Email",-1)),e[20]||(e[20]=t("th",{class:"px-6 py-3"},"Tags",-1)),e[21]||(e[21]=t("th",{class:"px-6 py-3"},"Last Contact",-1)),e[22]||(e[22]=t("th",{class:"px-6 py-3 text-right"},"Actions",-1))])]),t("tbody",ne,[(h(!0),w(I,null,j(a(s).contacts,d=>(h(),w("tr",{key:d.id,class:L(["hover:bg-slate-50 transition-colors cursor-pointer",f.value.includes(d.id)?"bg-blue-50/30":""]),onClick:S=>p(d)},[t("td",{class:"px-6 py-4",onClick:e[5]||(e[5]=V(()=>{},["stop"]))},[t("input",{type:"checkbox",class:"rounded border-slate-300 text-[#1B4F72] focus:ring-[#1B4F72]",checked:f.value.includes(d.id),onChange:S=>C(d.id)},null,40,re)]),t("td",ie,[t("div",de,[t("div",ce,g(d.first_name.charAt(0)),1),k(" "+g(d.first_name)+" "+g(d.last_name||""),1)])]),t("td",ue,g(d.phone||"-"),1),t("td",fe,g(d.email||"-"),1),t("td",pe,[t("div",ge,[(h(!0),w(I,null,j(d.tags||[],S=>(h(),w("span",{key:S,class:"px-2 py-0.5 rounded-full bg-slate-100 text-slate-600 text-xs font-medium border border-slate-200"},g(S),1))),128))])]),t("td",ve,g(l(d.last_contacted_at)),1),t("td",{class:"px-6 py-4 text-right",onClick:e[6]||(e[6]=V(()=>{},["stop"]))},[t("button",{onClick:V(S=>p(d),["stop"]),class:"p-1 text-slate-400 hover:text-[#1B4F72] rounded hover:bg-slate-100"},[v(a(pt),{size:16})],8,xe)])],10,le))),128)),a(s).contacts.length===0?(h(),w("tr",me,[...e[23]||(e[23]=[t("td",{colspan:"7",class:"px-6 py-8 text-center text-slate-500"}," No contacts found ",-1)])])):D("",!0)])])]),t("div",be,[t("span",he," Showing "+g((a(s).page-1)*a(s).perPage+1)+"- "+g(Math.min(a(s).page*a(s).perPage,a(s).total))+" of "+g(a(s).total),1),t("div",ye,[t("button",{disabled:a(s).page===1,onClick:e[7]||(e[7]=d=>E(a(s).page-1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-50"},[v(a(gt),{size:16})],8,we),t("button",{disabled:a(s).page*a(s).perPage>=a(s).total,onClick:e[8]||(e[8]=d=>E(a(s).page+1)),class:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50"},[v(a(vt),{size:16})],8,ze)])])])),f.value.length>0?(h(),w("div",ke,[t("span",Ce,g(f.value.length)+" contacts selected ",1),e[26]||(e[26]=t("div",{class:"h-4 w-px bg-white/20"},null,-1)),t("div",$e,[t("button",{onClick:H,class:"px-3 py-1.5 hover:bg-white/10 rounded-md transition-colors flex items-center gap-2 text-sm"},[v(a(xt),{size:16}),e[24]||(e[24]=k(" Delete ",-1))]),t("button",{onClick:e[9]||(e[9]=d=>M.value=!0),class:"px-3 py-1.5 hover:bg-white/10 rounded-md transition-colors flex items-center gap-2 text-sm"},[v(a(X),{size:16}),e[25]||(e[25]=k(" Add Tag ",-1))])]),t("button",{onClick:e[10]||(e[10]=d=>f.value=[]),class:"ml-2 p-1 hover:bg-white/10 rounded-full"},[v(a(R),{size:16})])])):D("",!0)]),v(Vt,{contact:P.value,"is-open":c.value,onClose:e[11]||(e[11]=d=>c.value=!1)},null,8,["contact","is-open"])]),_:1}))}});export{Ne as default};
