import{_ as V}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CfYC6v2a.js";import{d as E,r as m,a as R,c as D,L as q,o as M,b as T,w as U,p as t,m as p,s as N,v as k,u as S,x as P,n as O,y as u,F as j,q as F,X,f as g}from"./vue-vendor-BFreJ1An.js";import{a as x}from"./index-BsTtUH7V.js";import{useOrganizationsStore as h}from"./organizations-BeLDuyV9.js";import{b as Y}from"./status-DdzIA5VN.js";import{a5 as G,ak as H,ap as J}from"./ui-vendor-DelVp1tp.js";import"./utils-vendor-B9ygI19o.js";const b={getAll(r,o){return x.get(`/coordinator/organizations/${r}/campaigns`,{params:o})},getById(r,o){return x.get(`/coordinator/organizations/${r}/campaigns/${o}`)},create(r,o){return x.post(`/coordinator/organizations/${r}/campaigns`,o)},update(r,o,n){return x.put(`/coordinator/organizations/${r}/campaigns/${o}`,n)},delete(r,o){return x.delete(`/coordinator/organizations/${r}/campaigns/${o}`)},start(r,o){return x.post(`/coordinator/organizations/${r}/campaigns/${o}/start`)},pause(r,o){return x.post(`/coordinator/organizations/${r}/campaigns/${o}/pause`)},getStats(r,o){return x.get(`/coordinator/organizations/${r}/campaigns/${o}/stats`)}},K=E("campaigns",()=>{const r=m([]),o=m(null),n=m(!1),l=m(null),z=m(0),y=m(1),_=m(15);async function $(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{const a=await b.getAll(d,{...i,page:i?.page||y.value,per_page:i?.per_page||_.value});r.value=a.data.data,z.value=a.data.total||a.data.data.length,y.value=a.data.page||y.value,_.value=a.data.per_page||_.value}catch(a){throw l.value=a.response?.data?.message||"Failed to load campaigns",a}finally{n.value=!1}}async function B(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{const a=await b.getById(d,i);return o.value=a.data,a.data}catch(a){throw l.value=a.response?.data?.message||"Failed to load campaign",a}finally{n.value=!1}}async function I(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{const a=await b.create(d,i);return r.value.push(a.data),a.data}catch(a){throw l.value=a.response?.data?.message||"Failed to create campaign",console.error("Campaign creation error:",a),a}finally{n.value=!1}}async function A(i,c){n.value=!0,l.value=null;const a=h().currentOrganization?.id;if(!a){l.value="No organization selected.",n.value=!1;return}try{const v=await b.update(a,i,c),w=r.value.findIndex(L=>L.id===i);return w!==-1&&(r.value[w]=v.data),o.value?.id===i&&(o.value=v.data),v.data}catch(v){throw l.value=v.response?.data?.message||"Failed to update campaign",console.error("Campaign update error:",v),v}finally{n.value=!1}}async function f(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{await b.delete(d,i),r.value=r.value.filter(a=>a.id!==i),o.value?.id===i&&(o.value=null)}catch(a){throw l.value=a.response?.data?.message||"Failed to delete campaign",console.error("Campaign deletion error:",a),a}finally{n.value=!1}}async function s(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{const a=await b.start(d,i),v=r.value.findIndex(w=>w.id===i);return v!==-1&&(r.value[v]=a.data),a.data}catch(a){throw l.value=a.response?.data?.message||"Failed to start campaign",console.error("Campaign start error:",a),a}finally{n.value=!1}}async function e(i){n.value=!0,l.value=null;const d=h().currentOrganization?.id;if(!d){l.value="No organization selected.",n.value=!1;return}try{const a=await b.pause(d,i),v=r.value.findIndex(w=>w.id===i);return v!==-1&&(r.value[v]=a.data),a.data}catch(a){throw l.value=a.response?.data?.message||"Failed to pause campaign",console.error("Campaign pause error:",a),a}finally{n.value=!1}}return{campaigns:r,currentCampaign:o,loading:n,error:l,total:z,page:y,perPage:_,fetchCampaigns:$,fetchCampaign:B,createCampaign:I,updateCampaign:A,deleteCampaign:f,startCampaign:s,pauseCampaign:e,filteredCampaigns:i=>!i||i==="all"?r.value:r.value.filter(c=>c.status===i)}}),Q={class:"space-y-6"},W={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},Z={class:"border-b border-slate-200"},tt={class:"flex space-x-8"},et=["onClick"],at={key:0,class:"text-center py-12"},st={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ot={class:"p-6 border-b border-slate-100"},nt={class:"flex justify-between items-start mb-2"},rt={class:"text-lg font-bold text-slate-900"},lt={class:"text-sm text-slate-500"},it={key:0,class:"flex items-center gap-2 mt-2"},dt={class:"w-6 h-6 rounded-full bg-blue-100 text-[#1B4F72] flex items-center justify-center text-xs font-bold"},ut={class:"text-xs text-slate-500"},ct={class:"p-6"},gt={key:0,class:"space-y-4"},pt={class:"flex justify-between text-sm mb-2"},vt={class:"font-medium text-slate-900"},ft={class:"h-2 bg-slate-200 rounded-full overflow-hidden"},mt={class:"grid grid-cols-3 gap-4 text-center"},xt={class:"text-lg font-bold text-slate-900"},ht={class:"text-lg font-bold text-green-600"},_t={class:"text-lg font-bold text-amber-600"},bt={key:1,class:"space-y-3"},yt={class:"text-sm text-slate-600"},Ct={key:2,class:"text-sm text-slate-600"},wt={class:"mt-2"},zt={key:3,class:"text-sm text-slate-500"},St={class:"flex gap-2 mt-6 pt-4 border-t border-slate-100"},kt=["onClick"],Ft=["onClick"],$t=["onClick"],Bt={key:0,class:"lg:col-span-2 text-center py-12 bg-white rounded-xl border border-slate-200"},Lt=R({__name:"CampaignsPage",setup(r){const o=K(),n=h(),l=m("all"),z=m(!1),y=D(()=>{const f=o.campaigns.length,s=o.campaigns.filter(c=>c.status==="running").length,e=o.campaigns.filter(c=>c.status==="scheduled").length,C=o.campaigns.filter(c=>c.status==="completed").length,i=o.campaigns.filter(c=>c.status==="draft").length;return[{id:"all",label:"All",count:f},{id:"running",label:"Active",count:s},{id:"scheduled",label:"Scheduled",count:e},{id:"completed",label:"Completed",count:C},{id:"draft",label:"Drafts",count:i}]}),_=D(()=>o.filteredCampaigns(l.value==="all"?void 0:l.value));q(l,async f=>{n.currentOrganization&&await o.fetchCampaigns(f==="all"?{}:{status:f})});const $=Y;async function B(f){try{await o.pauseCampaign(f.id)}catch(s){console.error("Failed to pause campaign:",s)}}function I(f){}function A(f){}return M(async()=>{n.currentOrganization||(await n.fetchOrganizations(),n.organizations.length>0&&n.setCurrentOrganization(n.organizations[0])),n.currentOrganization&&await o.fetchCampaigns()}),(f,s)=>(g(),T(V,null,{default:U(()=>[t("div",Q,[t("div",W,[s[3]||(s[3]=t("div",null,[t("h1",{class:"text-3xl font-heading font-bold text-[#1B4F72]"}," Campaigns "),t("p",{class:"text-slate-500 mt-1"}," Automated outreach powered by your Coordinators ")],-1)),t("button",{onClick:s[0]||(s[0]=e=>z.value=!0),class:"px-5 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2"},[N(S(G),{size:18}),s[2]||(s[2]=k(" Create Campaign ",-1))])]),t("div",Z,[t("nav",tt,[(g(!0),p(j,null,P(y.value,e=>(g(),p("button",{key:e.id,onClick:C=>l.value=e.id,class:O(["py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",l.value===e.id?"border-[#1B4F72] text-[#1B4F72]":"border-transparent text-slate-500 hover:text-[#1B4F72] hover:border-slate-300"])},[k(u(e.label)+" ",1),t("span",{class:O(["px-2 py-0.5 rounded-full text-xs font-medium",l.value===e.id?"bg-blue-100 text-[#1B4F72]":"bg-slate-100 text-slate-500"])},u(e.count),3)],10,et))),128))])]),S(o).loading?(g(),p("div",at,[...s[4]||(s[4]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4F72]"},null,-1),t("p",{class:"mt-4 text-slate-500"},"Loading campaigns...",-1)])])):(g(),p("div",st,[(g(!0),p(j,null,P(_.value,e=>(g(),p("div",{key:e.id,class:"bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow overflow-hidden"},[t("div",ot,[t("div",nt,[t("div",null,[t("h3",rt,u(e.name),1),t("p",lt,u(e.type),1),e.coordinator?(g(),p("div",it,[t("div",dt,u(e.coordinator.display_name?.charAt(0)||"C"),1),t("span",ut,u(e.coordinator.display_name),1)])):F("",!0)]),t("span",{class:O(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",S($)(e.status)])},u(e.status.charAt(0).toUpperCase()+e.status.slice(1)),3)])]),t("div",ct,[e.status==="running"?(g(),p("div",gt,[t("div",null,[t("div",pt,[s[5]||(s[5]=t("span",{class:"text-slate-600"},"Progress",-1)),t("span",vt,u(e.contacts_processed||0)+" / "+u(e.target_count||0),1)]),t("div",ft,[t("div",{class:"h-full bg-[#1B4F72] rounded-full transition-all",style:X({width:`${(e.contacts_processed||0)/(e.target_count||1)*100}%`})},null,4)])]),t("div",mt,[t("div",null,[t("div",xt,u(e.answer_rate||0)+"%",1),s[6]||(s[6]=t("div",{class:"text-xs text-slate-500"},"Answer Rate",-1))]),t("div",null,[t("div",ht,u(e.confirmation_rate||0)+"%",1),s[7]||(s[7]=t("div",{class:"text-xs text-slate-500"},"Confirmed",-1))]),t("div",null,[t("div",_t,u(e.appointments_rescheduled||0),1),s[8]||(s[8]=t("div",{class:"text-xs text-slate-500"},"Rescheduled",-1))])])])):e.status==="completed"?(g(),p("div",bt,[t("div",yt,[s[9]||(s[9]=t("div",{class:"font-medium text-slate-900 mb-2"},"Final Results",-1)),t("div",null,"Contacted: "+u(e.contacts_contacted||0),1),t("div",null,"Answered: "+u(e.contacts_answered||0),1),t("div",null,"Appointments: "+u(e.appointments_booked||0),1)])])):e.status==="scheduled"?(g(),p("div",Ct,[s[10]||(s[10]=t("div",{class:"font-medium text-slate-900 mb-1"},"Starts",-1)),t("div",null,u(e.scheduled_start_at?new Date(e.scheduled_start_at).toLocaleString():"Not set"),1),t("div",wt,"Target: "+u(e.target_count||0)+" contacts",1)])):(g(),p("div",zt," Last edited "+u(e.updated_at?new Date(e.updated_at).toLocaleDateString():"Never"),1)),t("div",St,[e.status==="running"?(g(),p("button",{key:0,onClick:C=>B(e),class:"flex-1 py-2 px-3 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center justify-center gap-2"},[N(S(H),{size:16}),s[11]||(s[11]=k(" Pause ",-1))],8,kt)):F("",!0),e.status==="draft"?(g(),p("button",{key:1,onClick:C=>void 0,class:"flex-1 py-2 px-3 border border-slate-200 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors flex items-center justify-center gap-2"},[N(S(J),{size:16}),s[12]||(s[12]=k(" Edit ",-1))],8,Ft)):F("",!0),t("button",{onClick:C=>void 0,class:"flex-1 py-2 px-3 bg-[#1B4F72] text-white font-medium rounded-lg hover:bg-[#153e5a] transition-colors"}," View Details ",8,$t)])])]))),128)),_.value.length===0?(g(),p("div",Bt,[s[13]||(s[13]=t("p",{class:"text-slate-500 mb-4"},"No campaigns found",-1)),t("button",{onClick:s[1]||(s[1]=e=>z.value=!0),class:"px-5 py-2.5 bg-[#F59E0B] hover:bg-[#D97706] text-white font-semibold rounded-lg"}," Create Your First Campaign ")])):F("",!0)]))])]),_:1}))}});export{Lt as default};
