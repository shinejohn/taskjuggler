import{d as E,r as u}from"./vue-vendor-BFreJ1An.js";import{a as d}from"./index-BsTtUH7V.js";import{useOrganizationsStore as g}from"./organizations-BeLDuyV9.js";const v={getAll:(t,e)=>d.get(`/coordinator/organizations/${t}/appointments`,{params:e}),getToday:t=>d.get(`/coordinator/organizations/${t}/appointments/today`),getById:(t,e)=>d.get(`/coordinator/organizations/${t}/appointments/${e}`),create:(t,e)=>d.post(`/coordinator/organizations/${t}/appointments`,e),update:(t,e,o)=>d.put(`/coordinator/organizations/${t}/appointments/${e}`,o),cancel:(t,e,o)=>d.post(`/coordinator/organizations/${t}/appointments/${e}/cancel`,{reason:o}),delete:(t,e)=>d.delete(`/coordinator/organizations/${t}/appointments/${e}`)};class F{updates=new Map;register(e,o,i){this.updates.set(e,{id:e,data:o,timestamp:Date.now(),rollback:i})}confirm(e){this.updates.delete(e)}rollback(e){const o=this.updates.get(e);o&&(o.rollback(),this.updates.delete(e))}rollbackAll(){this.updates.forEach(e=>{e.rollback()}),this.updates.clear()}get(e){return this.updates.get(e)}has(e){return this.updates.has(e)}clear(){this.updates.clear()}}const y=new F;function N(t,e,o){return y.register(t,e,o),()=>{y.confirm(t)}}async function b(t,e,o,i){const s=N(t,e,o);try{const f=await i();return s(),f}catch(f){throw y.rollback(t),f}}const M=E("appointments",()=>{const t=u([]),e=u([]),o=u(null),i=u(!1),s=u(null),f=u(0),m=u(1),h=u(15);async function z(a){const r=g();if(!r.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{const n=await v.getAll(r.currentOrganization.id,{...a,page:a?.page||m.value,per_page:a?.per_page||h.value});t.value=n.data.data,f.value=n.data.total||n.data.data.length,m.value=n.data.page||m.value,h.value=n.data.per_page||h.value}catch(n){throw s.value=n.response?.data?.message||"Failed to load appointments",n}finally{i.value=!1}}async function O(){const a=g();if(!a.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{const r=await v.getToday(a.currentOrganization.id);e.value=r.data.data}catch(r){throw s.value=r.response?.data?.message||"Failed to load today's appointments",r}finally{i.value=!1}}async function S(a){const r=g();if(!r.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{const n=await v.getById(r.currentOrganization.id,a);return o.value=n.data,n.data}catch(n){throw s.value=n.response?.data?.message||"Failed to load appointment",n}finally{i.value=!1}}async function A(a){const r=g();if(!r.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;const n=`temp-${Date.now()}`,l={id:n,organization_id:r.currentOrganization.id,contact_id:a.contact_id||"",title:a.title||"",description:a.description,starts_at:a.starts_at||new Date().toISOString(),ends_at:a.ends_at||new Date().toISOString(),status:"pending",location_type:a.location_type||"in-person",location:a.location,notes:a.notes,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),...a},p=()=>{const c=t.value.findIndex(w=>w.id===n);c!==-1&&t.value.splice(c,1)};try{t.value.push(l);const c=await b(n,l,p,async()=>await v.create(r.currentOrganization.id,a)),w=t.value.findIndex(x=>x.id===n);return w!==-1?t.value[w]=c.data:t.value.push(c.data),c.data}catch(c){throw s.value=c.response?.data?.message||"Failed to create appointment",c}finally{i.value=!1}}async function _(a,r){const n=g();if(!n.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{const l=await v.update(n.currentOrganization.id,a,r),p=t.value.findIndex(c=>c.id===a);return p!==-1&&(t.value[p]=l.data),o.value?.id===a&&(o.value=l.data),l.data}catch(l){throw s.value=l.response?.data?.message||"Failed to update appointment",l}finally{i.value=!1}}async function $(a,r){const n=g();if(!n.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{const l=await v.cancel(n.currentOrganization.id,a,r),p=t.value.findIndex(c=>c.id===a);return p!==-1&&(t.value[p]=l.data),o.value?.id===a&&(o.value=l.data),l.data}catch(l){throw s.value=l.response?.data?.message||"Failed to cancel appointment",l}finally{i.value=!1}}async function I(a){const r=g();if(!r.currentOrganization?.id)throw new Error("No organization selected");i.value=!0,s.value=null;try{await v.delete(r.currentOrganization.id,a),t.value=t.value.filter(n=>n.id!==a),o.value?.id===a&&(o.value=null)}catch(n){throw s.value=n.response?.data?.message||"Failed to delete appointment",n}finally{i.value=!1}}return{appointments:t,todayAppointments:e,currentAppointment:o,loading:i,error:s,total:f,page:m,perPage:h,fetchAppointments:z,fetchTodayAppointments:O,fetchAppointment:S,createAppointment:A,updateAppointment:_,cancelAppointment:$,deleteAppointment:I}});export{M as u};
